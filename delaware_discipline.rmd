---
title: "Quarto"
---
Get started, loading & cleaning the data.
```{r setup, include=FALSE}
# Turn off scientific notation
options(scipen=999) 
library(tidyverse)
library(janitor)
library(magrittr) # use magrittr if you want to replicate the function of the tidyverse |> character in vscode or a similar program - this code uses the |> character a lot
library(dplyr)
library(ggthemes)

# Remove comment from the below read_csv line as necessary.
delaware_discipline <- read_csv("/Users/joellevtov/Library/CloudStorage/GoogleDrive-levtov@terpmail.umd.edu/My Drive/Journalism/delawarediscipline/delaware_student_discipline_raw.csv") |> 
    clean_names() |> 
    select(!geography) #the geography column reads either "All Students" or, for redacted rows, "NA" - so this will ignore the column
delaware_discipline$sub_group <- str_replace(delaware_discipline$sub_group, "Asian", "Asian Amerian") 

delaware_pop <- read_csv("/Users/joellevtov/Library/CloudStorage/GoogleDrive-levtov@terpmail.umd.edu/My Drive/Journalism/delawarediscipline/Student_Enrollment_20240209.csv") |> 
    clean_names()
delaware_pop$grade <- str_replace(delaware_pop$grade, "Twelfth", "12th Grade")
delaware_pop$sub_group <- str_replace(delaware_pop$sub_group, "Asian", "Asian American")

# Double check that everything worked as intended:
check <- as.data.frame(delaware_discipline) |> 
    filter(category == "Out-of-School Suspension without CDAP Placement")
head(check)
# If this returns 0 rows, everything is working perfectly. The raw data has two different phrases that mean the same thing - "Out-of-School Suspension, No CDAP Placement" and "Out-of-School Suspension without CDAP Placement". For clarity, I replaced the latter with the former.
```

Let's create a dataframe that addresses state-wide discipline policies.
```{r}
statewide_only_discipline <- delaware_discipline  |> 
    filter(district=="State of Delaware") 
```

And let's make the racial labels easier to type.
```{r}
race_categories <- as.data.frame(unique(na.omit(delaware_discipline$race))) 
colnames(race_categories)[1] <- "race"
race_categories <- as.data.frame(race_categories) |> 
    filter(race != "All Students") #removed the line that had "All Students" as a race
name_hisp <- race_categories[1,1]
name_native_am <- race_categories[2,1]
name_black <- race_categories[3,1]
name_white <- race_categories[4,1]
name_asian_am <- race_categories[5,1]
name_multi_racial <- race_categories[6,1]
name_hawaiian_pi <- race_categories[7,1]
```

Let's break down the <delaware_discipline> dataframe.
<school_year> shows what school year we are addressing
<district_code> is a column we will ignore, but it shows the number code of each district. The one we want is 0, the state of Delaware.
<district> shows in words the name of each district.
<school_code> shows the number code of each school.
<organization> shows the school name
<race> shows what race the statistics address
<special_demo> is a more clear version of the <sub_group> column. It shows what subgroup the statistics contained in the row are for
<sub_group> shows the above in a more complicated form -- i.e. instead of reading "ESL students", it might read "Hispanic/Latino/1st Grade/Out-of-School Suspension with CDAP/ESL students." This would be helpful, but it doesn't list all the statuses, e.g. what district one is looking at
<category> displays what type of discipline was applied - in-school discipline, out-of-school discipline, expulsion, etc.
<rowstatus> shows whether or not a row has been ommitted out of privacy concerns - if the pool of students is small enough, it would be possible to identify which students were disciplined, in theory
<students> shows the number of STUDENTS who were disciplined with <category>
<enrollment> shows the numer of students who fit into a certain <sub_group>
<pct_enrollment> shows what percent of the student body the studeents in <sub_group> make up
<incidents> shows the number of times <status> was applied - e.g the number of times a student got in-school suspension, NOT the number of students that got in-school suspension
<avg_duration> shows how many days students in <sub_group> were suspended for on average

The delaware_discipline dataset is very helpful, but is missing one key calculation -- on average, the number of students and incidents across all 8 years. So we'll create a table to display that and other tables along the way. 
race                             num_enrolled    num_disciplined    num_incidents   per_capita_disciplines length
Hispanic/Latino                  x               x                  x               x                       x
Native American                  x               x                  x               x                       x
African American                 x               x                  x               x                       x
White                            x               x                  x               x                       x
Asian American                   x               x                  x               x                       x
Multi-Racial                     x               x                  x               x                       x
Native Hawaiian/Pacific Islander x               x                  x               x                       x

<num_enrolled> is the average number of students in a grade across all eight years
<num_disciplined> is the average number of students that have faced discipline in each category
<num_of_incidents> is the average number of incidents (i.e. NOT the number of students)
<per_capita_disciplines> is the average number of students disciplined, i.e. num_students_disciplined/enrollement
<length> is the average length of a discipline measure in days

```{r}
# Declaring a new data frame and giving it the column names
demographics <- data.frame( 
    num_enrolled = numeric(),
    num_disciplined = numeric(), 
    num_incidents = numeric(),
    per_capita_disciplines = numeric(),
    length = numeric())
# Adding empty row containing only NA values
demographics[nrow(demographics) + 7, ] <- NA  
# Defining the row names
rownames(demographics) <- c(name_hisp, name_native_am, name_black, name_white, name_asian_am, name_multi_racial, name_hawaiian_pi)
print(demographics)
```

Now we can start calculating. First, let's calculate some statistics for later calculations.
```{r}
# This makes a table showing the number of students of x race enrolled each year.
# filter_race <- function(.data, race_name) {
#   filtered_race_data <- .data |>
#     filter(race == race_name, sub_group == race_name) |>
#     filter(!str_detect(grade, regex("Birth to 2 Years", ignore_case = TRUE))) |> 
#     summarize(sum = median(students))
#   return(filtered_race_data)
# }
# name_hisp <- race_name

# delaware_pop|> 
#     filter(race==name_black) |> 
#     filter(sub_group==name_black) |> 
#     filter(is.na(school_year))

# delaware_pop |> 
#     filter(race)

# pop_native_am <- pops|> 
#     filter(race==name_native_am) |> 
#     ignore_toddlers() |> 
#     filter(sub_group==name_native_am) |> 
#     summarize(sum=median(students))
# pop_black <- pops |> 
#     filter(race==name_black) |> 
#     ignore_toddlers() |> 
#     filter(sub_group==name_black) |> 
#     summarize(sum=median(students))
# pop_white <- pops |> 
#     filter(race==name_white) |> 
#     ignore_toddlers() |> 
#     filter(sub_group==name_white) |> 
#     summarize(sum=median(students)) 
# pop_asian_am <- pops |> 
#     filter(race==name_asian_am) |> 
#     ignore_toddlers() |> 
#     filter(sub_group==name_asian_am) |> 
#     summarize(sum=median(students))
# pop_multi_racial <- pops |> 
#     filter(race==name_multi_racial) |> 
#     ignore_toddlers() |> 
#     filter(sub_group==name_multi_racial) |> 
#     summarize(sum=median(students)) 
# pop_hawaiian_pi <- pops|> 
#     filter(race==name_hawaiian_pi) |> 
#     ignore_toddlers() |> 
#     filter(sub_group==name_hawaiian_pi) |> 
#     summarize(sum=median(students)) 
# demographics$num_enrolled <- c(pop_hisp, pop_native_am, pop_black, pop_white, pop_asian_am, pop_multi_racial, pop_hawaiian_pi)
# view(demographics)

# How many students of x race there are overall. Taking the median here so that we don't overcount the number of students, which summing would do. (Although, if we calculated the discipline numbers the same way, it shouldn't matter for the proportion.) Using the median because it won't be swayed by outliers, such as surges in enrollment. These are important stories, but not for these purposes.
library(stringr)
library(tidyverse)

filtered_race_data <- delaware_pop |>
    ungroup() |> 
    group_by(race, grade, gender, district_code, sub_group)  |> 
    summarize(students = median(na.omit(students)))
filtered_race_data$school_year <- NA
view(filtered_race_data)
redacted <- filtered_race_data |> 
    filter(is.na(students))
# This works well, we just have to keep in mind that Delaware has redacted several rows for small schools, such as the Positive Outcome Charter School - likely for FERPA reasons.

delaware_pop_copy <- delaware_pop |> 
    full_join(filtered_race_data, join_by(grade, sub_group, students, race, district_code, school_year))
# Perfect. Now we have all the statistics in one dataframe. If we want to know the average number of students in a certain category, e.g. Black homeless students, we set the year equal to 'NA'
```

So the dataframe pops shows us all the statistics we could ever want. We just have to manipulate it as necessary to show the population we're interested in. 
Now we'll calculate the average number of students disciplined (in-school, out-of-school, etc) and divide it by the average number of incidents.
```{r}
hisp_incidents <- statewide_only_discipline |> 
    filter(race == name_hisp) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_incidents=median(na.omit(incidents)), num_disc_students=sum(na.omit(students))) 
native_am_incidents <- statewide_only_discipline |> 
    filter(str_detect(race, name_native_am)) |> 
    filter(rowstatus=="REPORTED") |> 
hisp_incidents <- statewide_only_discipline |> 
    filter(str_detect(race, name_hisp)) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_incidents=sum(na.omit(incidents)), num_disc_students=sum(na.omit(students))) 
black_incidents <- statewide_only_discipline |> 
    filter(str_detect(race, name_black)) |> 
    filter(rowstatus=="REPORTED") |> 
hisp_incidents <- statewide_only_discipline |> 
    filter(str_detect(race, name_hisp)) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_incidents=sum(na.omit(incidents)), num_disc_students=sum(na.omit(students))) 
white_incidents <- statewide_only_discipline |> 
    filter(str_detect(race, name_white)) |> 
    filter(rowstatus=="REPORTED") |> 
hisp_incidents <- statewide_only_discipline |> 
    filter(str_detect(race, name_hisp)) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_incidents=sum(na.omit(incidents)), num_disc_students=sum(na.omit(students))) 
asian_am_incidents <- statewide_only_discipline |> 
    filter(str_detect(race, name_asian_am)) |> 
    filter(rowstatus=="REPORTED") |> 
hisp_incidents <- statewide_only_discipline |> 
    filter(str_detect(race, name_hisp)) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_incidents=sum(na.omit(incidents)), num_disc_students=sum(na.omit(students))) 
multi_racial_incidents <- statewide_only_discipline |> 
    filter(str_detect(race,name_multi_racial)) |> 
    filter(rowstatus=="REPORTED") |> 
hisp_incidents <- statewide_only_discipline |> 
    filter(str_detect(race, name_hisp)) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_incidents=sum(na.omit(incidents)), num_disc_students=sum(na.omit(students))) 
hawaiian_pi_incidents <- statewide_only_discipline |> 
    filter(str_detect(race, name_hawaiian_pi)) |> 
    filter(rowstatus=="REPORTED") |> 
hisp_incidents <- statewide_only_discipline |> 
    filter(str_detect(race, name_hisp)) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_incidents=sum(na.omit(incidents)), num_disc_students=sum(na.omit(students))) 
demographics$num_of_incidents <- c(hisp_incidents, native_am_incidents, black_incidents, white_incidents, asian_am_incidents, multi_racial_incidents, hawaiian_pi_incidents)
print(demographics)
```

Now, the mean number of incidents in each racial group. As you can see, white students had the most incidents on average, followed closely by Hispanic students and distantly by multi-racial students (though that's not exactly a fair calculation, there are only around 7000 multi-racial students in the state according to the data, so every incident, not accounting for the proportion, is going to matter that much more).
```{r}
hisp <- statewide_only_discipline |> 
    filter(str_detect(race, name_hisp)) |> 
    filter(rowstatus=="REPORTED") 
hisp_mean_incidents <- as.numeric(hisp$incidents)
hisp_mean_incidents <- hisp_mean_incidents |> 
    mean(hisp_mean_incidents, trim=0, na.rm=TRUE)
hisp_mean_incidents 
# for Native students
native_am <- statewide_only_discipline |> 
    filter(str_detect(race, name_native_am)) |> 
    filter(rowstatus=="REPORTED") 
native_am_mean_incidents <- as.numeric(native_am$incidents)
native_am_mean_incidents <- native_am_mean_incidents |> 
    mean(native_am_mean_incidents, trim=0, na.rm=TRUE)
# For Black students
black <- statewide_only_discipline |> 
    filter(str_detect(race, name_black)) |> 
    filter(rowstatus=="REPORTED") 
black_mean_incidents <- as.numeric(native_am$incidents)
black_mean_incidents <- black_mean_incidents |> 
    mean(black_mean_incidents, trim=0, na.rm=TRUE)
# For white students
white <- statewide_only_discipline |> 
    filter(str_detect(race, name_white)) |> 
    filter(rowstatus=="REPORTED")  
white_mean_incidents <- as.numeric(white$incidents)
white_mean_incidents <- white_mean_incidents |> 
    mean(white_mean_incidents, trim=0, na.rm=TRUE)
demographics[4, 4] = round(white_mean_incidents, digits=1)
# For Asian students
asian_am <- statewide_only_discipline |> 
    filter(str_detect(race, name_asian_am)) |> 
    filter(rowstatus=="REPORTED") 
asian_am_mean_incidents <- as.numeric(asian_am$incidents)
asian_am_mean_incidents <- asian_am_mean_incidents |> 
    mean(asian_am_mean_incidents, trim=0, na.rm=TRUE)
demographics[5, 4] = round(asian_am_mean_incidents, digits=1)
# For multi-racial students
multi_racial <- statewide_only_discipline |> 
    filter(str_detect(race, name_multi_racial)) |> 
    filter(rowstatus=="REPORTED") 
multi_racial_mean_incidents <- as.numeric(multi_racial$incidents)
multi_racial_mean_incidents <- multi_racial_mean_incidents |> 
    mean(multi_racial_mean_incidents, trim=0, na.rm=TRUE)
# For hawaiian-pacific islander students
hawaiian_pi <- statewide_only_discipline |> 
    filter(str_detect(race, name_hawaiian_pi)) |> 
    filter(rowstatus=="REPORTED") 
hawaiian_pi_mean_incidents <- as.numeric(hawaiian_pi$incidents)
hawaiian_pi_mean_incidents <- hawaiian_pi_mean_incidents |> 
    mean(hawaiian_pi_mean_incidents, trim=0, na.rm=TRUE)
demographics$avg_incidents <- c(hisp_mean_incidents, native_am_mean_incidents, black_mean_incidents, white_mean_incidents, asian_am_mean_incidents, multi_racial_mean_incidents, hawaiian_pi_mean_incidents)
demographics <- demographics |> 
    arrange(desc(avg_incidents))
print(demographics)
```

That average we calculated is helpful, but doesn't take into account what portion of the student body students make up. So we'll calculate the per capita average - taking into account the proportion of students.
```{r}
demographics <- demographics |> 
    mutate(per_capita=(per_capita = as.numeric(num_of_incidents)/as.numeric(num_enrolled))*100)
demographics <- demographics |> 
    arrange(desc(per_capita))
print(demographics)
```

Let's make a graph.
```{r}
demographics_graph <- demographics |> 
    arrange(per_capita)

demographics_graph |> 
    ggplot() +
    geom_col(aes(x=reorder(race, per_capita), y=per_capita), fill="darkblue") +
    labs(
        title="Black and Native American students are far more likely to face discipline in Delaware.",
        x= "race",
        y="avg"
    ) +
    theme_economist()
```

What's clear from this data is that Black and Native American students are far more likely to be disciplined -- almost twice as likely as the next group, multi-racial students. It bears noting, though, that there are relatively few multi-racial students - though there are even less Asian/Pacific Islander students in Delaware. But do they get more serious discipline - e.g. out-of-school suspension vs. in-school discipline? Let's dive deeper into the data. First, let's create some variables - there are six types of discipline noted in the data - in-school suspension, out-of-school suspension (with and without CDAP -- "Consortium Discipline Alternative Program" -- placement, used when the student has been punished through school programs without improving and they "routinely and seriously disrupt the classroom"). 
```{r}
name_in_school_sus <- "In-School Suspension" 
name_oos_no_cdap <- "Out-of-School Suspension, No CDAP Placement"    
name_oos_cdap <- "Out-of-School Suspension with CDAP Placement"   
name_expulsion <-"Expulsion (Permanent Removal from School)"      
```

Thanks to our data cleanup at the beginning, everything works. Here's a template for later, for making tables.
race                             method     num_enrolled   num_of_incidents     per_capita
Hispanic/Latino                  x          x              x                    x      
Native American                  x          x              x                    x 
African American                 x          x              x                    x 
White                            x          x              x                    x 
Asian American                   x          x              x                    x  
Multi-Racial                     x          x              x                    x  
Native Hawaiian/Pacific Islander x          x              x                    x  
```{r}
demographics_detailed <- data.frame (
    race = character(),
    method = character(),
    num_enrolled = numeric(),
    num_of_incidents = numeric()
    )
demographics_detailed[nrow(demographics_detailed) + 7, ] <- NA  
demographics_detailed$race <- c(name_hisp, name_native_am, name_black, name_white, name_asian_am, name_multi_racial, name_hawaiian_pi)
demographics_detailed$num_enrolled <- c(pop_hisp, pop_native_am, pop_black, pop_white, pop_asian_am, pop_multi_racial, pop_hawaiian_pi)

print(demographics_detailed)
```

First, let's tackle in-school suspension. 
```{r}
# Creating the appropriate emty dataframe
in_school_suspensions <- demographics_detailed 
in_school_suspensions$method[1:7] <- name_in_school_sus
# Calculating the number of students of a certain race who were suspended in school
hisp_in_school_sus <- statewide_only_discipline |> 
    filter(race==name_hisp) |> 
    filter(category==name_in_school_sus) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(students))) 
in_school_suspensions[1,4] <- hisp_in_school_sus
native_am_in_school_sus <- statewide_only_discipline |> 
    filter(race==name_native_am) |> 
    filter(category==name_in_school_sus) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(students))) 
in_school_suspensions[2,4] <- native_am_in_school_sus
black_in_school_sus <- statewide_only_discipline |> 
    filter(race==name_black) |> 
    filter(category==name_in_school_sus) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(students))) 
in_school_suspensions[3,4] <- black_in_school_sus
white_in_school_sus <- statewide_only_discipline |> 
    filter(race==name_white) |> 
    filter(category==name_in_school_sus) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(students))) 
in_school_suspensions[4,4] <- white_in_school_sus
asian_am_in_school_sus <- statewide_only_discipline |> 
    filter(race==name_asian_am) |> 
    filter(category==name_in_school_sus) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(students))) 
in_school_suspensions[5,4] <- asian_am_in_school_sus
multi_racial_in_school_sus <- statewide_only_discipline |> 
    filter(race==name_multi_racial) |> 
    filter(category==name_in_school_sus) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(students))) 
in_school_suspensions[6,4] <- multi_racial_in_school_sus
hawaiian_pi_in_school_sus <- statewide_only_discipline |> 
    filter(race==name_hawaiian_pi) |> 
    filter(category==name_in_school_sus) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(students))) 
in_school_suspensions[7,4] <- hawaiian_pi_in_school_sus
in_school_suspensions$num_enrolled <- c(pop_hisp, pop_native_am, pop_black, pop_white, pop_asian_am, pop_multi_racial, pop_hawaiian_pi)
in_school_suspensions <- in_school_suspensions |> 
    mutate(per_capita = (num_of_incidents/as.numeric(num_enrolled))*100)
print(in_school_suspensions)
in_school_suspensions_graph <- in_school_suspensions |> 
    arrange(desc(per_capita))
print(in_school_suspensions_graph)
in_school_suspensions_graph |> 
    ggplot() +
    geom_col(aes(x=reorder(race, per_capita), y=per_capita), fill="darkblue") +
    labs(
        title="Black students most likely to face in-school discipline in Delaware.",
        x= "race",
        y="avg"
    ) +
    theme_economist()
```

Very interesting. Now, let's see about out-of-school suspensions with CDAP.
```{r}
oos_cdap <- demographics_detailed 
oos_cdap$method <- name_oos_cdap
hisp_oos_cdap <- statewide_only_discipline |> 
    filter(race==name_hisp) |> 
    filter(category==name_oos_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(incidents))) 
native_am_oos_cdap <- statewide_only_discipline |> 
    filter(race==name_native_am) |> 
    filter(category==name_oos_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(incidents))) 
black_oos_cdap <- statewide_only_discipline |> 
    filter(race==name_black) |> 
    filter(category==name_oos_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(incidents))) 
white_oos_cdap <- statewide_only_discipline |> 
    filter(race==name_white) |> 
    filter(category==name_oos_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(incidents))) 
asian_am_oos_cdap <- statewide_only_discipline |> 
    filter(race==name_asian_am) |> 
    filter(category==name_oos_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(incidents))) 
multi_racial_oos_cdap <- statewide_only_discipline |> 
    filter(race==name_multi_racial) |> 
    filter(category==name_oos_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(incidents))) 
hawaiian_pi_oos_cdap <-statewide_only_discipline |> 
    filter(race==name_hawaiian_pi) |> 
    filter(category==name_oos_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(num_disciplined=sum(na.omit(incidents))) 
oos_cdap$num_of_incidents <- c(hisp_oos_cdap, native_am_oos_cdap, black_oos_cdap, white_oos_cdap, asian_am_oos_cdap, multi_racial_oos_cdap, hawaiian_pi_oos_cdap)
oos_cdap <- oos_cdap |> 
    mutate(per_capita = (as.numeric(num_of_incidents)/as.numeric(num_enrolled))*100)
oos_cdap_graph <- oos_cdap
oos_cdap_graph <- oos_cdap_graph |> 
    arrange(desc(per_capita))
oos_cdap_graph |> 
    ggplot() +
    geom_col(aes(x=reorder(race, per_capita), y=per_capita), fill="darkblue") +
    labs(
        title="Black students far more likely to face out-of-school discipline with CDAP in Delaware.",
        x= "race",
        y="avg"
    ) +
    theme_economist()
```
Let's see about out-of-school suspensions without CDAP.
```{r}
oos_no_cdap <- demographics_detailed
oos_no_cdap$method <- name_oos_no_cdap
hisp_oos_no_cdap <- statewide_only_discipline |> 
    filter(race==name_hisp) |> 
    filter(category==name_oos_no_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
native_am_oos_no_cdap <- statewide_only_discipline |> 
    filter(race==name_native_am) |> 
    filter(category==name_oos_no_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
black_oos_no_cdap <- statewide_only_discipline |> 
    filter(race==name_black) |> 
    filter(category==name_oos_no_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
white_oos_no_cdap <- statewide_only_discipline |> 
    filter(race==name_white) |> 
    filter(category==name_oos_no_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
asian_am_oos_no_cdap <- statewide_only_discipline |> 
    filter(race==name_asian_am) |> 
    filter(category==name_oos_no_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
multi_racial_oos_no_cdap <- statewide_only_discipline |> 
    filter(race==name_multi_racial) |> 
    filter(category==name_oos_no_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
hawaiian_pi_oos_no_cdap <-statewide_only_discipline |> 
    filter(race==name_hawaiian_pi) |> 
    filter(category==name_oos_no_cdap) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
oos_no_cdap$num_of_incidents <- c(hisp_oos_no_cdap, native_am_oos_no_cdap, black_oos_no_cdap, white_oos_no_cdap, asian_am_oos_no_cdap, multi_racial_oos_no_cdap, hawaiian_pi_oos_no_cdap)
oos_no_cdap <- oos_no_cdap |> 
    mutate(per_capita = (as.numeric(num_of_incidents)/as.numeric(num_enrolled))*100)
oos_no_cdap_graph <- oos_no_cdap
oos_no_cdap_graph <- oos_no_cdap_graph |> 
    arrange(desc(per_capita))
oos_no_cdap_graph |> 
    ggplot() +
    geom_col(aes(x=reorder(race, per_capita), y=per_capita), fill="darkblue") +
    labs(
        title="Native - not Black - students far more likely to face out-of-school suspension without CDAP placement",
        x="race",
        y="avg"
    ) +
    theme_economist()
```

```{r}
expulsion <- demographics_detailed
expulsion$method <- name_expulsion
hisp_expulsion <- statewide_only_discipline |> 
    filter(race==name_hisp) |> 
    filter(category==name_expulsion) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
native_am_expulsion <- statewide_only_discipline |> 
    filter(race==name_native_am) |> 
    filter(category==name_expulsion) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
black_expulsion <- statewide_only_discipline |> 
    filter(race==name_black) |> 
    filter(category==name_expulsion) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
white_expulsion <- statewide_only_discipline |> 
    filter(race==name_white) |> 
    filter(category==name_expulsion) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
asian_am_expulsion <- statewide_only_discipline |> 
    filter(race==name_asian_am) |> 
    filter(category==name_expulsion) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
multi_racial_expulsion <- statewide_only_discipline |> 
    filter(race==name_multi_racial) |> 
    filter(category==name_expulsion) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
hawaiian_pi_expulsion <- statewide_only_discipline |> 
    filter(race==name_hawaiian_pi) |> 
    filter(category==name_expulsion) |> 
    filter(rowstatus=="REPORTED") |> 
    summarize(count=n())
expulsion$num_of_incidents <- c(hisp_expulsion, native_am_expulsion, black_expulsion, white_expulsion, asian_am_expulsion, multi_racial_expulsion, hawaiian_pi_expulsion)
expulsion <- expulsion |> 
    mutate(per_capita = (as.numeric(num_of_incidents)/as.numeric(num_enrolled))*100)
expulsion_graph <- expulsion
expulsion_graph <- expulsion_graph |> 
    arrange(desc(per_capita))
expulsion_graph |> 
    ggplot() +
    geom_col(aes(x=reorder(race, per_capita), y=per_capita), fill="darkblue") +
    labs(
        title="Black students far more likely to face expulsion",
        x="race",
        y="avg"
    ) +
    theme_economist()

```

race                num_enrolled    num_disciplined     per_capita
hispanic            x               x                   x
native american     x               x                   x
african american    x               x                   x
white               x               x                   x
multi-racial        x               x                   x
hawaiian/pi         x               x                   x
